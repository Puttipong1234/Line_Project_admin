drawing_data = {"replyToken":'', "messages": [{
  "type": "flex",
  "altText": "Flex Message",
  "contents": {
    "type": "carousel",
    "contents": [
      {
        "type": "bubble",
        "direction": "ltr",
        "header": {
          "type": "box",
          "layout": "vertical",
          "contents": [
            {
              "type": "text",
              "text": "แบบสถาปัติ",
              "size": "xxl",
              "align": "center",
              "gravity": "center",
              "weight": "regular",
              "color": "#FFFFFF"
            }
          ]
        },
        "body": {
          "type": "box",
          "layout": "vertical",
          "spacing": "lg",
          "contents": [
            {
              "type": "box",
              "layout": "horizontal",
              "spacing": "none",
              "contents": [
                {
                  "type": "text",
                  "text": "No.",
                  "align": "start"
                },
                {
                  "type": "separator"
                },
                {
                  "type": "text",
                  "text": "Name",
                  "flex": 6,
                  "align": "center"
                },
                {
                  "type": "separator"
                },
                {
                  "type": "spacer"
                }
              ]
            }
          ]
        },
        "footer": {
          "type": "box",
          "layout": "horizontal",
          "contents": [
            {
              "type": "button",
              "action": {
                "type": "message",
                "label": "UPLOAD",
                "text": "UPLOAD"
              },
              "flex": 5,
              "style": "primary"
            },
            {
              "type": "button",
              "action": {
                "type": "uri",
                "label": "DEL",
                "uri": "https://linecorp.com"
              },
              "flex": 0,
              "color": "#FF0000",
              "margin": "lg",
              "style": "primary"
            }
          ]
        },
        "styles": {
          "header": {
            "backgroundColor": "#323232"
          }
        }
      },
      {
        "type": "bubble",
        "direction": "ltr",
        "header": {
          "type": "box",
          "layout": "vertical",
          "contents": [
            {
              "type": "text",
              "text": "แบบโครงสร้าง",
              "size": "xxl",
              "align": "center",
              "gravity": "center",
              "color": "#FFFFFF"
            }
          ]
        },
        "body": {
          "type": "box",
          "layout": "vertical",
          "spacing": "lg",
          "contents": [
            {
              "type": "box",
              "layout": "horizontal",
              "spacing": "none",
              "contents": [
                {
                  "type": "text",
                  "text": "No.",
                  "align": "start"
                },
                {
                  "type": "separator"
                },
                {
                  "type": "text",
                  "text": "Name",
                  "flex": 6,
                  "align": "center"
                },
                {
                  "type": "separator"
                },
                {
                  "type": "spacer"
                }
              ]
            }
          ]
        },
        "footer": {
          "type": "box",
          "layout": "horizontal",
          "contents": [
            {
              "type": "button",
              "action": {
                "type": "message",
                "label": "UPLOAD",
                "text": "UPLOAD"
              },
              "flex": 5,
              "style": "primary"
            },
            {
              "type": "button",
              "action": {
                "type": "uri",
                "label": "DEL",
                "uri": "https://linecorp.com"
              },
              "flex": 0,
              "color": "#FF0000",
              "margin": "lg",
              "style": "primary"
            }
          ]
        },
        "styles": {
          "header": {
            "backgroundColor": "#323232"
          }
        }
      },
      {
        "type": "bubble",
        "direction": "ltr",
        "header": {
          "type": "box",
          "layout": "vertical",
          "contents": [
            {
              "type": "text",
              "text": "แบบงานระบบ",
              "size": "xxl",
              "align": "center",
              "gravity": "center",
              "weight": "regular",
              "color": "#FFFFFF"
            }
          ]
        },
        "body": {
          "type": "box",
          "layout": "vertical",
          "spacing": "lg",
          "contents": [
            {
              "type": "box",
              "layout": "horizontal",
              "spacing": "none",
              "contents": [
                {
                  "type": "text",
                  "text": "No.",
                  "align": "start"
                },
                {
                  "type": "separator"
                },
                {
                  "type": "text",
                  "text": "Name",
                  "flex": 6,
                  "align": "center"
                },
                {
                  "type": "separator"
                },
                {
                  "type": "spacer"
                }
              ]
            }
          ]
        },
        "footer": {
          "type": "box",
          "layout": "horizontal",
          "contents": [
            {
              "type": "button",
              "action": {
                "type": "message",
                "label": "UPLOAD",
                "text": "UPLOAD"
              },
              "flex": 5,
              "style": "primary"
            },
            {
              "type": "button",
              "action": {
                "type": "uri",
                "label": "DEL",
                "uri": "https://linecorp.com"
              },
              "flex": 0,
              "color": "#FF0000",
              "margin": "lg",
              "style": "primary"
            }
          ]
        },
        "styles": {
          "header": {
            "backgroundColor": "#323232"
          }
        }
      },
      {
        "type": "bubble",
        "direction": "ltr",
        "header": {
          "type": "box",
          "layout": "vertical",
          "contents": [
            {
              "type": "text",
              "text": "แบบงานระบบไฟฟ้า",
              "size": "xxl",
              "align": "center",
              "gravity": "center",
              "weight": "regular",
              "color": "#FFFFFF"
            }
          ]
        },
        "body": {
          "type": "box",
          "layout": "vertical",
          "spacing": "lg",
          "contents": [
            {
              "type": "box",
              "layout": "horizontal",
              "spacing": "none",
              "contents": [
                {
                  "type": "text",
                  "text": "No.",
                  "align": "start"
                },
                {
                  "type": "separator"
                },
                {
                  "type": "text",
                  "text": "Name",
                  "flex": 6,
                  "align": "center"
                },
                {
                  "type": "separator"
                },
                {
                  "type": "spacer"
                }
              ]
            }
          ]
        },
        "footer": {
          "type": "box",
          "layout": "horizontal",
          "contents": [
            {
              "type": "button",
              "action": {
                "type": "message",
                "label": "UPLOAD",
                "text": "UPLOAD"
              },
              "flex": 5,
              "style": "primary"
            },
            {
              "type": "button",
              "action": {
                "type": "uri",
                "label": "DEL",
                "uri": "https://linecorp.com"
              },
              "flex": 0,
              "color": "#FF0000",
              "margin": "lg",
              "style": "primary"
            }
          ]
        },
        "styles": {
          "header": {
            "backgroundColor": "#323232"
          }
        }
      },
      {
        "type": "bubble",
        "direction": "ltr",
        "header": {
          "type": "box",
          "layout": "vertical",
          "contents": [
            {
              "type": "text",
              "text": "แบบระบบประปา",
              "size": "xxl",
              "align": "center",
              "gravity": "center",
              "weight": "regular",
              "color": "#FFFFFF"
            }
          ]
        },
        "body": {
          "type": "box",
          "layout": "vertical",
          "spacing": "lg",
          "contents": [
            {
              "type": "box",
              "layout": "horizontal",
              "spacing": "none",
              "contents": [
                {
                  "type": "text",
                  "text": "No.",
                  "align": "start"
                },
                {
                  "type": "separator"
                },
                {
                  "type": "text",
                  "text": "Name",
                  "flex": 6,
                  "align": "center"
                },
                {
                  "type": "separator"
                },
                {
                  "type": "spacer"
                }
              ]
            }
          ]
        },
        "footer": {
          "type": "box",
          "layout": "horizontal",
          "contents": [
            {
              "type": "button",
              "action": {
                "type": "message",
                "label": "UPLOAD",
                "text": "UPLOAD"
              },
              "flex": 5,
              "style": "primary"
            },
            {
              "type": "button",
              "action": {
                "type": "uri",
                "label": "DEL",
                "uri": "https://linecorp.com"
              },
              "flex": 0,
              "color": "#FF0000",
              "margin": "lg",
              "style": "primary"
            }
          ]
        },
        "styles": {
          "header": {
            "backgroundColor": "#323232"
          }
        }
      }
    ]
  }
    }
  ]
}

drawing_dict = {
    'แบบสถาปัติ' : 0,
    'แบบโครงสร้าง': 1,
    'แบบงานระบบ': 2,
    'แบบงานระบบไฟฟ้า': 3,
    'แบบระบบประปา': 4
}

import json
import requests
from Project.UI.Flex_Template import each_drawing_in_list
from Project import app
import os


### function การส่ง Flex message
### ใส่ drawing_name แล้ว index ไปที่ bubble นั้นๆ เพื่อ อัพเดต list of drawing
def update_drawing_list(drawing_name,drawing_to_update):
    update_drawing = each_drawing_in_list()
    index = drawing_dict[drawing_name]
    drawing_data['messages'][0]["contents"]["contents"][index]['body']['content'].append(each_drawing_in_list)

### send_flex message with list of content inside
def send_flex(reply_token,drawing_data):

    LINE_API = 'https://api.line.me/v2/bot/message/reply'

    Authorization = 'Bearer 1RfIiAbjneORMpj+sIGYx+Yi0esjdG/F/VQxyIc6/dFoCVym6hZzDrBqxpd5Ui8XFLsdzohfRuvZRU1dsCP0yaSN3Rdx7U3PeT/0kZfnkrAXrmtrclZaw0v/tA6vOe2fM93R+JvDab5xhxN/4vtGYQdB04t89/1O/w1cDnyilFU='

    headers = {'Content-Type': 'application/json; charset=UTF-8',
  'Authorization': Authorization}

    drawing_data['replyToken'] = reply_token
    #### dumps file ให้เป็น
    drawing_data = json.dumps(drawing_data)

    r = requests.post(LINE_API, headers=headers, data=drawing_data) # ส่งข้อมูล

    return print(r.text)